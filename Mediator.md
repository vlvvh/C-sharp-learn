# ä¸­ä»‹è€…æ¨¡å¼ ï¼ˆ Mediator pattern ï¼‰
ä¸­ä»‹è€…æ¨¡å¼åœ¨ç°å®ç”Ÿæ´»ä¸­æœ‰å¾ˆå¤šä¾‹å­ï¼Œæ¯”å¦‚ï¼šA å’Œ B åšç”Ÿæ„ï¼ŒA æˆ– B çš„æƒ³æ³•ä¼šç»å¸¸å˜åŒ–ï¼Œæ¯æ¬¡æ”¹å˜æ—¶å‘Šè¯‰å¯¹æ–¹ï¼Œä¼šä½¿å¯¹æ–¹å¾ˆåæ„Ÿã€‚å¦‚æœåœ¨ A å’Œ B ä¹‹é—´å¢åŠ ä¸€ä¸ª C å¯¹è±¡ï¼Œåœ¨æœ€ç»ˆç¡®å®šä¹‹å‰ä¸è¦å‘Šè¯‰ C å¯¹è±¡ï¼Œå¯¹æ–¹å°±ä¸çŸ¥é“äº†ï¼ˆéš”ç¦»äº†è€¦åˆï¼Œå¯¹æ–¹å¯ä»¥æ›´å…·éœ€æ±‚å˜åŒ–ï¼‰ï¼Œ
ç­‰ä¸€æ–¹æœ€ç»ˆç¡®å®šæƒ³æ³•åï¼ŒæŠŠæœ€åå†³å®šå‘Šè¯‰ C å¯¹è±¡ï¼ŒC å†è½¬å‘Šç»™å¯¹æ–¹ã€‚è¿™æ ·å°±ç®€åŒ–äº† A å’Œ B çš„äº¤æ˜“è¿‡ç¨‹ï¼Œè€Œä¸”åŒæ–¹éƒ½å¾ˆæ»¡æ„ã€‚       

åœ¨è½¯ä»¶æ„å»ºè¿‡ç¨‹ä¸­ï¼Œå› ä¸ºæœ‰äº†å˜åŒ–ï¼Œæ‰æœ‰å¢åŠ ä¸­ä»‹è€…çš„éœ€è¦ â€¼ï¸       
å˜åŒ–æ˜¯æ¨¡å¼çš„å‰æï¼Œæ— è®ºæ˜¯ä»€ä¹ˆæ¨¡å¼ï¼Œå°±å› ä¸ºæœ‰å˜åŒ–ï¼Œæˆ‘ä»¬éœ€è¦æŠµå¾¡å˜åŒ–ï¼Œæ‰è¦ä½¿ç”¨ç›¸åº”çš„æ¨¡å¼è§£å†³é—®é¢˜ã€‚   

## ä¸€ã€æ¨¡å¼çš„è¯¦ç»†ä»‹ç»      
### 1.1 åŠ¨æœº
åœ¨è½¯ä»¶æ„å»ºè¿‡ç¨‹ä¸­ï¼Œç»å¸¸ä¼šå‡ºç°å¤šä¸ªå¯¹è±¡äº’ç›¸å…³è”äº¤äº’çš„æƒ…å†µï¼Œå¯¹è±¡ä¹‹é—´å¸¸å¸¸ä¼šç»´æŒä¸€ç§å¤æ‚çš„å¼•ç”¨å…³ç³»ï¼Œå¦‚æœé‡åˆ°ä¸€äº›éœ€æ±‚çš„æ›´æ”¹ï¼Œè¿™ç§ç›´æ¥çš„å¼•ç”¨å…³ç³»å°†é¢ä¸´ä¸æ–­å˜åŒ–ã€‚          
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥**ä½¿ç”¨ä¸€ä¸ªâ€œä¸­ä»‹å¯¹è±¡â€æ¥ç®¡ç†å¯¹è±¡é—´çš„å…³è”å…³ç³»ï¼Œé¿å…ç›¸äº’äº¤äº’çš„å¯¹è±¡ä¹‹é—´çš„ç´§è€¦åˆå¼•ç”¨å…³ç³»ï¼Œä»è€Œæ›´å¥½çš„æŠµå¾¡å˜åŒ–ã€‚**

### 1.2 æ„å›¾
å®šä¹‰äº†ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥å°è£…ä¸€ç³»åˆ—å¯¹è±¡ä¹‹é—´çš„äº¤äº’å…³ç³»ã€‚ä¸­ä»‹è€…ä½¿å„ä¸ªå¯¹è±¡ä¹‹é—´ä¸éœ€è¦æ˜¾å¼åœ°ç›¸äº’å¼•ç”¨ï¼Œä»è€Œä½¿è€¦åˆæ€§é™ä½ï¼Œè€Œä¸”å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜ä»–ä»¬ä¹‹é—´çš„äº¤äº’è¡Œä¸ºã€‚   

### 1.3 ç»“æ„å›¾
![image](https://github.com/vlvvh/C-sharp-learn/assets/160467935/5c3e6f56-b7da-4985-935e-086dce492790)

### 1.4 æ¨¡å¼çš„ç»„æˆ
( 1 ) æŠ½è±¡ä¸­ä»‹è€…è§’è‰² ( Mediator ):åœ¨è¿™é‡Œå®šä¹‰äº†å„ä¸ªå¯¹è±¡ä¹‹é—´äº¤äº’éœ€è¦çš„æ–¹æ³•ã€‚å¯ä»¥æ˜¯å…¬ä¼—çš„é€šä¿¡æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æ˜¯å°èŒƒå›´çš„äº¤äº’æ–¹æ³•ã€‚ 

( 2 ) å…·ä½“ä¸­ä»‹è€…è§’è‰² ( ConcreteMediator ):å®ç°äº†ä¸­ä»‹è€…æ¥å£ï¼Œå®ƒéœ€è¦äº†è§£å¹¶ç»´æŠ¤å„ä¸ªåŒäº‹å¯¹è±¡ï¼Œå¹¶è´Ÿè´£å…·ä½“çš„åè°ƒå„åŒäº‹å¯¹è±¡ä¹‹é—´çš„äº¤äº’å…³ç³»ã€‚

( 3 ) æŠ½è±¡åŒäº‹ç±»( Colleague ): å®šä¹‰äº†ä¸€ä¸ªæ¥å£æˆ–æŠ½è±¡ç±»ï¼Œé€šå¸¸ä¸ºæŠ½è±¡ç±»ï¼Œä¸»è¦çº¦æŸåŒäº‹å¯¹è±¡çš„ç±»å‹ï¼Œå¹¶å®ç°ä¸€äº›å…·ä½“åŒäº‹ç±»ä¹‹é—´çš„å…¬å…±åŠŸèƒ½   

      æ¯”å¦‚:æ¯ä¸ªå…·ä½“åŒäº‹ç±»éƒ½åº”è¯¥çŸ¥é“ä¸­ä»‹è€…å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å…·ä½“åŒäº‹ç±»éƒ½ä¼šæŒæœ‰ä¸­ä»‹è€…å¯¹è±¡ï¼Œéƒ½å¯ä»¥åˆ°è¿™ä¸ªç±»é‡Œé¢ã€‚ 

( 4 ) å…·ä½“åŒäº‹ç±»( ConcreteConlleague ):å®ç°è‡ªå·±çš„ä¸šåŠ¡ï¼Œ**éœ€è¦ä¸å…¶ä»–åŒäº‹é€šä¿¡æ—¶å€™ï¼Œå°±ä¸æŒæœ‰çš„ä¸­ä»‹è€…é€šä¿¡ï¼Œä¸­ä»‹è€…ä¼šè´Ÿè´£ä¸å…¶ä»–åŒäº‹ç±»äº¤äº’**

### 1.5 æ¨¡å¼çš„å…·ä½“å®ç°
#### ä¸¾ä¸ªä¾‹å­ğŸŒ°ï¼š
åœ¨å…¬å¸ç®¡ç†è¿‡ç¨‹ä¸­ï¼Œå°±ä¼šæ¶‰åŠåˆ°å„ä¸ªéƒ¨é—¨ä¹‹é—´çš„åè°ƒå’Œåˆä½œï¼Œæ²Ÿé€šåè°ƒå°±éœ€è¦ä¸€ä¸ªäººæ¥åšï¼Œå‡è®¾æ˜¯æ€»ç»ç†ï¼ŒæŠŠæ€»ç»ç†å®šä¹‰ä¸ºç®¡ç†è€…ï¼Œå„ä¸ªéƒ¨é—¨éœ€è¦å‘ä»–æ±‡æŠ¥å’Œå‘èµ·å·¥ä½œè¯·æ±‚ã€‚ä»£ç å¦‚ä¸‹ï¼š
~~~
using Microsoft.VisualBasic;

namespace ä¸­ä»‹è€…æ¨¡å¼çš„å®ç°
{
    // æŠ½è±¡ä¸­ä»‹è€…è§’è‰²
    public interface IMediator
    {
        void Command(Department department);
    }
    
    // å…·ä½“ä¸­ä»‹è€…è§’è‰²ï¼šæ€»ç»ç†
    public sealed class President : IMediator
    {
        // æ€»ç»ç†æœ‰å„éƒ¨é—¨çš„ç®¡ç†æƒé™
        private Financial _financial;
        private Market _market;
        private Development _development;

        // è´¢åŠ¡éƒ¨
        public void SetFinancial(Financial financial)
        {
            this._financial = financial;
        }
        // ç ”å‘éƒ¨
        public void SetDevelopment(Development development)
        {
            this._development = development;
        }

        // å¸‚åœºéƒ¨
        public void SetMarket(Market maket)
        {
            this._market = maket;
        }

        public void Command(Department department)
        {
            if (department.GetType() == typeof(Market))
            {
                _financial.Process();
            }
        }
    }
    // æŠ½è±¡åŒäº‹ç±» åŒäº‹ç±»çš„æ¥å£
    public abstract class Department
    {
        // æŒæœ‰ä¸­ä»‹è€…ï¼ˆæ€»ç»ç†ï¼‰çš„å¼•ç”¨
        private IMediator mediator;

        protected Department(IMediator mediator)
        {
            this.mediator = mediator;
        }

        public IMediator GetMediator
        {
            get { return mediator; }
            private set { this.mediator = value; }
        }
        // åšæœ¬éƒ¨é—¨çš„äº‹
        public abstract void Process();
        // å‘æ€»ç»ç†å‘å‡ºç”³è¯·
        public abstract void Apply();
    }
    
    //å…·ä½“åŒäº‹ç±»1:ç ”å‘éƒ¨
    public sealed class Development:Department
    {
        public Development(IMediator m):base(m){ }

        public override void Process()
        {
            Console.WriteLine("ç ”å‘éƒ¨é—¨å‘æ€»ç»ç†æ±‡æŠ¥ï¼šæˆ‘æ˜¯ç ”å‘éƒ¨ï¼Œéœ€è¦èµ„é‡‘æ”¯æŒ");
        }

        public override void Apply()
        {
            Console.WriteLine("ç ”å‘éƒ¨é—¨å†³å®šï¼šä¸“å¿ƒç§‘ç ”ï¼Œå¼€å‘é¡¹ç›®ï¼");
        }
    }
    //å…·ä½“åŒäº‹ç±»2:è´¢åŠ¡éƒ¨
    public sealed class Financial : Department
    {
        public Financial(IMediator m):base(m){}

        public override void Process()
        {
            Console.WriteLine("è´¢åŠ¡éƒ¨é—¨å‘æ€»ç»ç†æ±‡æŠ¥ï¼šé’±å¤ªå¤šäº†ï¼æ€ä¹ˆèŠ±ï¼Ÿ");
        }

        public override void Apply()
        {
            Console.WriteLine("è´¢åŠ¡éƒ¨æ‰§è¡ŒåŠ¨ä½œï¼šæ•°é’±");
        }
    }
    // å…·ä½“åŒäº‹ç±»3:å¸‚åœºéƒ¨
    public sealed class Market : Department
    {
        public Market(IMediator m):base(m){}

        public override void Process()
        {
            Console.WriteLine("å¸‚åœºéƒ¨é—¨å‘æ€»ç»ç†æ±‡æŠ¥ï¼šé¡¹ç›®æ‰¿æ¥ï¼Œéœ€è¦èµ„é‡‘æ”¯æŒ");
        }

        public override void Apply()
        {
            Console.WriteLine("å¸‚åœºéƒ¨å†³å®šï¼šæ¥é¡¹ç›®");
        }
    }

    class Program
    {
        static void Main(String[] args)
        {
            President mediator = new President();

            Market market = new Market(mediator);
            Development development = new Development(mediator);
            Financial financial = new Financial(mediator);
            
            mediator.SetMarket(market);
            mediator.SetDevelopment(development);
            mediator.SetFinancial(financial);
            
            market.Apply();
            development.Apply();
            financial.Apply();

            Console.Read();
        }
    }
    
~~~
è¿è¡Œç»“æœï¼š
![image](https://github.com/vlvvh/C-sharp-learn/assets/160467935/cbfa465e-451c-4555-bd7f-cf0c2513d7fd)

## äºŒã€æ¨¡å¼å®ç°çš„è¦ç‚¹
å°†å¤šä¸ªå¯¹è±¡é—´å¤æ‚çš„å…³è”å…³ç³»è§£è€¦ï¼ŒMediatoræ¨¡å¼å°†å¤šä¸ªå¯¹è±¡é—´çš„æ§åˆ¶é€»è¾‘è¿›è¡Œé›†ä¸­ç®¡ç†ã€å˜"å¤šä¸ªå¯¹è±¡äº’ç›¸å…³è”â€ä¸º"å¤šä¸ªå¯¹è±¡å’Œä¸€ä¸ªä¸­ä»‹è€…å…³è”â€ï¼Œç®€åŒ–äº†ç³»ç»Ÿçš„ç»´æŠ¤ï¼ŒæŠµå¾¡äº†å¯èƒ½çš„å˜åŒ–ã€‚éšç€æ§åˆ¶é€»è¾‘çš„å¤æ‚åŒ–ï¼ŒMediatorå…·ä½“å¯¹è±¡çš„å®ç°å¯èƒ½ç›¸å½“å¤æ‚ã€‚è¿™æ—¶å€™å¯ä»¥å¯¹Mediatorå¯¹è±¡è¿›è¡Œåˆ†è§£å¤„ç†ï¼Œ
- Facadeæ¨¡å¼ï¼šæ˜¯è§£è€¦ç³»ç»Ÿå¤–åˆ°ç³»ç»Ÿå†…ï¼ˆå•å‘ï¼‰çš„ç›¸å…³è”å…³ç³»
- Mediatoræ¨¡å¼ï¼šæ˜¯è§£è€¦ç³»ç»Ÿå†…å„ä¸ªå¯¹è±¡ä¹‹é—´ï¼ˆåŒå‘ï¼‰çš„å…³è”å…³ç³»

### 2.1 Mediatorçš„ä¼˜ç‚¹âœ…
#### 1 ï¼‰æ¾æ•£è€¦åˆ
ä¸­ä»‹è€…æ¨¡å¼é€šè¿‡æŠŠå¤šä¸ªåŒäº‹å¯¹è±¡ä¹‹é—´çš„äº¤äº’å°è£…åˆ°ä¸­ä»‹å¯¹è±¡é‡Œé¢ï¼Œä»è€Œä½¿å¾—å¯¹è±¡ä¹‹é—´æ¾æ•£è€¦åˆï¼ŒåŸºæœ¬ä¸Šå¯ä»¥åšåˆ°äº’ä¸ä¾èµ–ã€‚
#### 2 ï¼‰é›†ä¸­æ§åˆ¶äº¤äº’
å¤šä¸ªåŒäº‹å¯¹è±¡çš„äº¤äº’ï¼Œè¢«å°è£…åœ¨ä¸­ä»‹è€…å¯¹è±¡é‡Œé¢é›†ä¸­ç®¡ç†ï¼Œä½¿å¾—è¿™äº›äº¤äº’è¡Œä¸ºå‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œåªéœ€è¦ä¿®æ”¹ä¸­ä»‹è€…å°±å¯ä»¥äº†
#### 3 ï¼‰å¤šå¯¹å¤šå˜ä¸€å¯¹å¤š
ä¸­ä»‹è€…å’ŒåŒäº‹å¯¹è±¡çš„å…³ç³»é€šå¸¸å˜ä¸ºåŒå‘çš„ä¸€å¯¹ï¼Œè®©å¯¹è±¡å…³ç³»æ›´å®¹æ˜“ç†è§£


### 2.2 Mediatorçš„ç¼ºç‚¹:negative_squared_cross_mark:
#### 1 ï¼‰è¿‡å¤šçš„é›†ä¸­åŒ–
ä½¿ä¸­ä»‹è€…å¯¹è±¡å˜å¾—ååˆ†å¤æ‚ï¼Œéš¾äºç»´æŠ¤ç®¡ç†

âš ï¸å¦‚ä¸ä½¿ç”¨Mediatorä¼šæ„æˆå¦‚ä¸‹å›¾çš„ç½‘çŠ¶ç»“æ„
![image](https://github.com/vlvvh/C-sharp-learn/assets/160467935/c112f247-b7e4-4f10-9104-07fc01da2ed9)
ä½¿ç”¨åä¼šå¦‚ä¸‹å›¾ï¼š
![image](https://github.com/vlvvh/C-sharp-learn/assets/160467935/4e6414d9-e876-463e-96d4-118dc7b9c14a)

